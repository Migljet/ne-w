<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Каталог</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        /* Базовые стили под тему Телеграм */
        body { font-family: sans-serif; background-color: var(--tg-theme-bg-color, #fff); color: var(--tg-theme-text-color, #000); margin: 0; padding: 10px; }
        .card { border: 1px solid #ccc; border-radius: 10px; padding: 10px; margin-bottom: 10px; display: flex; align-items: center; }
        .card img { width: 60px; height: 60px; object-fit: cover; border-radius: 5px; margin-right: 15px; }
        .info { flex-grow: 1; }
        .price { font-weight: bold; color: var(--tg-theme-button-color, #3390ec); }
        .controls { display: flex; align-items: center; gap: 10px; }
        button { padding: 5px 10px; border: none; border-radius: 5px; cursor: pointer; background: var(--tg-theme-button-color, #3390ec); color: #fff; }
        
        /* Скрытая форма заказа */
        #order-form { display: none; padding: 20px; text-align: center; }
        input { width: 90%; padding: 10px; margin-bottom: 10px; border: 1px solid #ddd; border-radius: 5px; }
        #main-btn { width: 100%; padding: 15px; background: #31b545; color: white; font-size: 16px; font-weight: bold; border: none; border-radius: 10px; margin-top: 20px; }
    </style>
</head>
<body>

    <div id="catalog">
        <h2>Наши товары</h2>
        <div id="list"></div>
        <button id="checkout-btn" onclick="showOrderForm()" style="width:100%; margin-top:20px; display:none;">Оформить заказ</button>
    </div>

    <div id="order-form">
        <h3>Ваши данные</h3>
        <input type="text" id="name" placeholder="Ваше имя">
        <input type="tel" id="phone" placeholder="Телефон">
        <div id="summary"></div>
        <button id="main-btn" onclick="sendDataToBot()">Отправить заказ</button>
        <button onclick="backToCatalog()" style="background: gray; margin-top: 10px;">Назад</button>
    </div>

<script>
    let tg = window.Telegram.WebApp;
    tg.expand(); // Раскрываем на весь экран

    // === ТВОИ ТОВАРЫ ТУТ ===
    const products = [
        { id: 1, title: "Футболка Black", price: 1500, img: "https://via.placeholder.com/60" },
        { id: 2, title: "Кепка Red", price: 800, img: "https://via.placeholder.com/60" },
        { id: 3, title: "Худи White", price: 3500, img: "https://via.placeholder.com/60" }
    ];

    let cart = {}; // Корзина: {id_товара: количество}

    // Отрисовка товаров
    const list = document.getElementById('list');
    products.forEach(p => {
        let div = document.createElement('div');
        div.className = 'card';
        div.innerHTML = `
            <img src="${p.img}" alt="">
            <div class="info">
                <div>${p.title}</div>
                <div class="price">${p.price} ₽</div>
            </div>
            <div class="controls">
                <button onclick="changeQty(${p.id}, -1)">-</button>
                <span id="qty-${p.id}">0</span>
                <button onclick="changeQty(${p.id}, 1)">+</button>
            </div>
        `;
        list.appendChild(div);
    });

    // Логика +/-
    function changeQty(id, delta) {
        if (!cart[id]) cart[id] = 0;
        cart[id] += delta;
        if (cart[id] < 0) cart[id] = 0;
        
        document.getElementById(`qty-${id}`).innerText = cart[id];
        
        // Показываем кнопку "Оформить", если в корзине что-то есть
        let totalItems = Object.values(cart).reduce((a, b) => a + b, 0);
        document.getElementById('checkout-btn').style.display = totalItems > 0 ? 'block' : 'none';
    }

    function showOrderForm() {
        document.getElementById('catalog').style.display = 'none';
        document.getElementById('order-form').style.display = 'block';
        
        // Считаем итог
        let total = 0;
        let summaryText = "";
        for (let id in cart) {
            if (cart[id] > 0) {
                let p = products.find(p => p.id == id);
                total += p.price * cart[id];
                summaryText += `<p>${p.title} x ${cart[id]} шт.</p>`;
            }
        }
        summaryText += `<h3>Итого: ${total} ₽</h3>`;
        document.getElementById('summary').innerHTML = summaryText;
    }

    function backToCatalog() {
        document.getElementById('catalog').style.display = 'block';
        document.getElementById('order-form').style.display = 'none';
    }

    // === ГЛАВНАЯ ФУНКЦИЯ ОТПРАВКИ ===
    function sendDataToBot() {
        let name = document.getElementById('name').value;
        let phone = document.getElementById('phone').value;

        if (!name || !phone) {
            alert("Введите имя и телефон!");
            return;
        }

        let data = {
            cart: cart,
            total: document.getElementById('summary').innerText,
            user_info: { name: name, phone: phone }
        };

        // Отправляем JSON строку боту
        tg.sendData(JSON.stringify(data));
    }
</script>
</body>
</html>
